# 测试环境配置
pekko {
  pekko-sys = "pekko-cluster-system-test"
  
  # 启用集群Actor提供者
  actor.provider = "cluster"
  
  # 序列化绑定
  actor {
    serialization-bindings {
      "cn.xuyinyin.magic.common.CborSerializable" = jackson-cbor
    }
  }
  
  # 集群配置
  cluster {
    # 测试环境种子节点
    seed-nodes = []
    
    # 节点角色
    roles = ["worker"]
    
    # 快速故障检测（测试环境）
    failure-detector {
      acceptable-heartbeat-pause = 1s
      threshold = 4.0
    }
    
    # 禁用自动downing（测试环境）
    auto-down-unreachable-after = off
    
    # Cluster Sharding配置
    sharding {
      # 测试环境使用较少的分片
      number-of-shards = 10
      
      # 角色限制
      role = "worker"
      
      # 测试环境快速Passivation
      passivate-idle-entity-after = 1m
      
      # Remember Entities
      remember-entities = on
      remember-entities-store = "eventsourced"
      
      # 快速再平衡
      rebalance-interval = 2s
      least-shard-allocation-strategy {
        rebalance-threshold = 2
        max-simultaneous-rebalance = 3
      }
      
      # 较短的超时时间
      waiting-for-state-timeout = 2s
      updating-state-timeout = 2s
    }
  }
  
  # 远程配置（测试环境）
  remote {
    artery {
      enabled = true
      transport = tcp
      canonical {
        hostname = "127.0.0.1"
        port = 0  # 自动分配端口
      }
    }
  }
  
  # Event Sourcing持久化配置（测试环境使用内存存储）
  persistence {
    journal {
      plugin = "pekko.persistence.journal.inmem"
      inmem {
        test-serialization = on
      }
    }
    
    snapshot-store {
      plugin = "pekko.persistence.snapshot-store.local"
      local {
        dir = "target/test-snapshots"
      }
    }
  }
  
  # 工作流事件溯源配置
  workflow {
    event-sourcing {
      # 测试环境更频繁的快照
      snapshot-every = 10
      keep-n-snapshots = 2
    }
  }
  
  # 日志配置（测试环境）
  loglevel = "INFO"
  stdout-loglevel = "INFO"
  
  # Actor测试配置
  actor {
    testkit {
      # 测试超时配置
      typed {
        default-timeout = 10s
        expect-no-message-default = 100ms
      }
    }
  }
}
