pekko {
  pekko-sys = "pekko-cluster-system"
  project-version = "0.2"
  
  # 全局任务限制配置（用于GC控制）
  global-task-limit = 10
  
  # 启用集群Actor提供者
  actor.provider = "cluster"
  
  # 序列化绑定
  actor {
    serialization-bindings {
      "cn.xuyinyin.magic.common.CborSerializable" = jackson-cbor
    }
  }
  
  # 集群配置
  cluster {
    # 种子节点配置
    seed-nodes = ["pekko://pekko-cluster-system@127.0.0.1:2551"]
    
    # 节点角色配置（可以通过环境变量或系统属性覆盖）
    roles = ["coordinator", "worker", "api-gateway"]
    
    # 脑裂解决策略
    downing-provider-class = "org.apache.pekko.cluster.sbr.SplitBrainResolverProvider"
    
    # 节点退出策略
    min-nr-of-members = 1
    
    # 故障检测配置
    failure-detector {
      acceptable-heartbeat-pause = 3s
      threshold = 12.0
    }
    
    # 自动downing配置
    auto-down-unreachable-after = 10s
    
    # ClusterSingleton配置
    singleton {
      # 最少成员数要求（设置为1，单节点也能工作）
      min-number-of-hand-over-retries = 3
      # 等待singleton完成停止的时间
      hand-over-timeout = 10s
      # 等待singleton完成启动的时间  
      lease-implementation = "none"
    }
  }
  
  # 远程配置
  remote {
    artery {
      enabled = true
      transport = tcp
      canonical {
        hostname = "127.0.0.1"
        port = 2551
      }
    }
  }
  
  # Event Sourcing持久化配置
  persistence {
    journal {
      plugin = "pekko.persistence.journal.leveldb"
      leveldb {
        dir = "target/journal"
        native = false
        # 生产环境建议使用 Cassandra 或 PostgreSQL
      }
    }
    
    snapshot-store {
      plugin = "pekko.persistence.snapshot-store.local"
      local {
        dir = "target/snapshots"
      }
    }
    
    # 自动启动持久化查询
    query {
      journal {
        leveldb {
          refresh-interval = 1s
        }
      }
    }
  }
  
  # 工作流事件溯源配置
  workflow {
    event-sourcing {
      # 每100个事件保存一次快照
      snapshot-every = 100
      # 保留最近2个快照
      keep-n-snapshots = 2
    }
  }
}


# Load using SlickSession.forConfig("slick-h2")
slick-h2 {
  profile = "slick.jdbc.H2Profile$"
  db {
    connectionPool = disabled
    dataSourceClass = "slick.jdbc.DriverDataSource"
    properties = {
      driver = "org.h2.Driver"
      url = "jdbc:h2:"${java.io.tmpdir}"/pekko-connectors-slick-h2-test"
    }
  }
}