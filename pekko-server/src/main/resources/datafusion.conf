# DataFusion SQL查询节点配置
#
# 此配置文件定义了DataFusion Service的连接参数和连接池配置
# 
# 使用方式：
# 1. 在application.conf中include此文件：include "datafusion.conf"
# 2. 或者通过环境变量覆盖配置

datafusion {
  # 是否启用DataFusion集成
  # 如果设置为false，SQL查询节点将不可用
  enabled = true
  enabled = ${?DATAFUSION_ENABLED}
  
  # DataFusion Service地址
  host = "localhost"
  host = ${?DATAFUSION_HOST}
  
  # DataFusion Service端口 (Arrow Flight)
  port = 50051
  port = ${?DATAFUSION_PORT}
  
  # 连接池配置
  pool {
    # 最大连接数
    maxTotal = 10
    maxTotal = ${?DATAFUSION_POOL_MAX_TOTAL}
    
    # 最大空闲连接数
    maxIdle = 5
    maxIdle = ${?DATAFUSION_POOL_MAX_IDLE}
    
    # 最小空闲连接数
    minIdle = 2
    minIdle = ${?DATAFUSION_POOL_MIN_IDLE}
    
    # 连接超时（毫秒）
    connectTimeout = 5000
    connectTimeout = ${?DATAFUSION_POOL_CONNECT_TIMEOUT}
    
    # 请求超时（毫秒）
    requestTimeout = 30000
    requestTimeout = ${?DATAFUSION_POOL_REQUEST_TIMEOUT}
  }
  
  # 查询默认配置
  query {
    # 默认批处理大小
    defaultBatchSize = 1000
    defaultBatchSize = ${?DATAFUSION_QUERY_DEFAULT_BATCH_SIZE}
    
    # 默认查询超时（秒）
    defaultTimeout = 30
    defaultTimeout = ${?DATAFUSION_QUERY_DEFAULT_TIMEOUT}
    
    # 最大重试次数
    maxRetries = 3
    maxRetries = ${?DATAFUSION_QUERY_MAX_RETRIES}
    
    # 重试延迟（毫秒）
    retryDelay = 1000
    retryDelay = ${?DATAFUSION_QUERY_RETRY_DELAY}
  }
  
  # 监控配置
  monitoring {
    # 是否启用Prometheus指标
    metricsEnabled = true
    metricsEnabled = ${?DATAFUSION_METRICS_ENABLED}
    
    # 是否启用结构化日志
    structuredLogging = true
    structuredLogging = ${?DATAFUSION_STRUCTURED_LOGGING}
    
    # 慢查询阈值（毫秒）
    slowQueryThreshold = 5000
    slowQueryThreshold = ${?DATAFUSION_SLOW_QUERY_THRESHOLD}
  }
  
  # 健康检查配置
  healthCheck {
    # 健康检查间隔（秒）
    interval = 30
    interval = ${?DATAFUSION_HEALTH_CHECK_INTERVAL}
    
    # 健康检查超时（毫秒）
    timeout = 5000
    timeout = ${?DATAFUSION_HEALTH_CHECK_TIMEOUT}
    
    # 失败阈值（连续失败多少次后标记为不健康）
    failureThreshold = 3
    failureThreshold = ${?DATAFUSION_HEALTH_CHECK_FAILURE_THRESHOLD}
  }
}
